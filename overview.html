
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zarr Data Overview &#8212; Pangeo / ESGF Cloud Data Working Group  documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Accessing data in the cloud" href="accessing_data.html" />
    <link rel="prev" title="Background and Links" href="background.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/small_e_logo_cropped.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Pangeo / ESGF Cloud Data Working Group  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="working_group.html">
   Working Group Meetings and Membership
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="background.html">
   Background and Links
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Zarr Data Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="accessing_data.html">
   Accessing data in the cloud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pangeo_catalog.html">
   Pangeo Catalog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/overview.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/pangeo-data/pangeo-cmip6-cloud"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/pangeo-data/pangeo-cmip6-cloud/issues/new?title=Issue%20on%20page%20%2Foverview.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/pangeo-data/pangeo-cmip6-cloud/edit/master/docs/overview.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements">
   Requirements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-locations">
   Data Locations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#zarr-storage-format">
   Zarr storage format
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#directory-structure">
   Directory structure
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#csv-file-structure">
   CSV file structure
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="zarr-data-overview">
<h1>Zarr Data Overview<a class="headerlink" href="#zarr-data-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>First and foremost, a Zarr package is required to interact with the data stores.
Listed below are languages with actively developed Zarr packages; bolded languages do not yet have Zarr packages that support the reading of remote data stores:</p>
<ul class="simple">
<li><p>Python: <a class="reference external" href="https://github.com/zarr-developers/zarr-python">zarr-developers/zarr-python</a></p></li>
<li><p>TypeScript: <a class="reference external" href="https://github.com/gzuidhof/zarr.js/">gzuidhof/zarr.js</a></p></li>
<li><p><strong>C++</strong>: <a class="reference external" href="https://github.com/constantinpape/z5">constantinpape/z5</a></p></li>
<li><p>Julia: <a class="reference external" href="https://github.com/meggart/Zarr.jl">meggart/zarr.jl</a></p></li>
<li><p><strong>Java</strong>: <a class="reference external" href="https://github.com/saalfeldlab/n5-zarr">saalfeldlab/n5-zarr</a></p></li>
<li><p>Scala: <a class="reference external" href="https://github.com/lasersonlab/ndarray.scala">lasersonlab/ndarray.scala</a></p></li>
<li><p>C: <a class="reference external" href="https://github.com/Unidata/netcdf-c/tree/master/libnczarr">Unidata/netcdf-c/libnczarr</a></p></li>
</ul>
<p>Additionally, a filesystem package for Google Cloud and/or S3 storage is required for some languages to access the files containing the data stores:</p>
<ul class="simple">
<li><p>Python: <a class="reference external" href="https://gcsfs.readthedocs.io/en/latest/">gcsfs</a> or <a class="reference external" href="https://s3fs.readthedocs.io/en/latest/">s3fs</a></p></li>
<li><p>Julia: <a class="reference external" href="https://github.com/JuliaCloud/AWSCore.jl">AWSCore</a></p></li>
</ul>
<p>Though optional, a CSV-loading package allows for searching and filtering of the Zarr data stores, which are enumerated in CSV files located at the root of each cloud storage bucket.
Python users are encouraged to use <a class="reference external" href="https://xarray.pydata.org/en/stable/">xarray</a>, <a class="reference external" href="https://intake.readthedocs.io/en/stable/">intake</a>, and <a class="reference external" href="https://intake-esm.readthedocs.io/en/stable/">intake-esm</a>, which facilitate exploration and interaction with the data through the use of Earth System Model (ESM) collection specifications which are also provided at the root of each bucket.</p>
</div>
<div class="section" id="data-locations">
<h2>Data Locations<a class="headerlink" href="#data-locations" title="Permalink to this headline">¶</a></h2>
<p>CMIP6 data in the cloud can be found in both Google Cloud and AWS S3 storage buckets:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gs://cmip6</span></code> (part of <a class="reference external" href="https://cloud.google.com/public-datasets">Google Cloud Public Datasets</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s3://cmip6-pds</span></code> (part of the <a class="reference external" href="https://aws.amazon.com/opendata/public-datasets/">AWS Open Data Sponsorship Program</a>)</p></li>
</ul>
<p>The data is primarily <a class="reference external" href="https://zarr.readthedocs.io/en/stable/">Zarr</a>-formatted, with a predetermined and well-defined directory structure to ensure that it is properly organized and classified.
This directory structure is reflected in the master CSV files located at the root of each bucket, which enumerates all available Zarr stores using their containing directory names as columns to allow for sorting and filtering.</p>
</div>
<div class="section" id="zarr-storage-format">
<h2>Zarr storage format<a class="headerlink" href="#zarr-storage-format" title="Permalink to this headline">¶</a></h2>
<p>Each data store in the CMIP6 collection consists of all of the data, including the grids and metadata, stored in Zarr format.
This format stores the data as a collection of files consisting of regular text files containing metadata and data files consisting of the data divided into compressed chunks which can be read individually or in parallel, allowing very large datasets to scale more efficiently in the cloud.</p>
<p>The original datasets, stored in the WCRP/CMIP6 ESGF repositories, consist of <a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/">netCDF</a> files.
Each of these datasets typically corresponds to a single variable saved at specified time intervals for the length of a single model run.
For convenience, these datasets were often divided into multiple netCDF files.
Our Zarr data stores correspond to the result of concatenating these netCDF files and then storing them as a single Zarr object.
All of the metadata in the original netCDF files has been preserved, including the licensing information and the CMIP6 persistent identifiers (<code class="docutils literal notranslate"><span class="pre">tracking_ids</span></code>) which are unique for each of the original netCDF files.</p>
<p>A Zarr data store <code class="docutils literal notranslate"><span class="pre">tracking_id</span></code> consists of a concatenated list of the netCDF <code class="docutils literal notranslate"><span class="pre">tracking_ids</span></code> from which it was created. An individual <code class="docutils literal notranslate"><span class="pre">tracking_id</span></code> can be looked up at <a class="reference external" href="http://hdl.handle.net/">Handle.net</a>  (e.g., enter “<a class="reference external" href="hdl:21.14100/33cbdc29-fbc9-44ab-9e09-5dc7824441cf">hdl:21.14100/33cbdc29-fbc9-44ab-9e09-5dc7824441cf</a>”, which then redirects <a class="reference external" href="https://handle-esgf.dkrz.de/lp/21.14100/33cbdc29-fbc9-44ab-9e09-5dc7824441cf/">here</a>).</p>
</div>
<div class="section" id="directory-structure">
<h2>Directory structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p><strong>UPDATE: Feb. 1, 2021:</strong> Please note that our zarr store names, and therefore the URLs for our zarr stores,  has recently changed. For example, the prefix is now <code class="docutils literal notranslate"><span class="pre">gs://cmip6/CMIP6/</span></code> on GC and <code class="docutils literal notranslate"><span class="pre">s3://cmip6-pds/CMIP6/</span></code> on AWS S3. In addition, conforming to the ESGF syntax, we have appended the <code class="docutils literal notranslate"><span class="pre">version_id</span></code> (e.g., /v20200101) to the names.</p>
<p>To organize the data there is a list of keywords, each with a <a class="reference external" href="https://github.com/WCRP-CMIP/CMIP6_CVs">controlled vocabulary</a> which has been developed over the many CMIP iterations.
The keywords categorize the model data in the many ways we might want to search the data.
For example, to find all available 3-hourly precipitation data from the pre-industrial control runs, we only need to specify the variable, frequency and experiment name.
In this case, the keywords <code class="docutils literal notranslate"><span class="pre">['variable_id',</span> <span class="pre">'table_id',</span> <span class="pre">'experiment_id']</span></code> will have the values <code class="docutils literal notranslate"><span class="pre">['pr',</span> <span class="pre">'3hr',</span> <span class="pre">'piControl']</span></code>.
The data are now structured in this cloud repository using 9 of these keywords in this order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmip6[-pds]/CMIP6/
└──&lt;activity_id&gt;/
    └──&lt;institution_id&gt;/
        └──&lt;source_id&gt;/
            └──&lt;experiment_id&gt;/
                └──&lt;member_id&gt;/
                    └──&lt;table_id&gt;/
                        └──&lt;variable_id&gt;/
                            └──&lt;grid_label&gt;/
                                └──&lt;version_id&gt;/
</pre></div>
</div>
<p>Each object specified in this way refers to a single Zarr data store.</p>
</div>
<div class="section" id="csv-file-structure">
<h2>CSV file structure<a class="headerlink" href="#csv-file-structure" title="Permalink to this headline">¶</a></h2>
<p>We maintain CSV files listing the most recent versions of the Zarr data stores, providing the keyword values in columns as well as the dataset URLs and some additional information.  These files allow for rapid searching by keyword using your favorite spreadsheet software.  For example, in python, we generally use the <cite>pandas</cite> package.</p>
<p>There are two different master CSV files located at the root of the buckets; one contains only datasets with no serious issues listed in the official <a class="reference external" href="https://errata.es-doc.org/static/index.html">ESGF Errata Service</a>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://storage.googleapis.com/cmip6/pangeo-cmip6.csv">https://storage.googleapis.com/cmip6/pangeo-cmip6.csv</a></p></li>
<li><p><a class="reference external" href="https://cmip6-pds.s3-us-west-2.amazonaws.com/pangeo-cmip6.csv">https://cmip6-pds.s3-us-west-2.amazonaws.com/pangeo-cmip6.csv</a></p></li>
</ul>
<p>And the other contains all available Zarr data stores, including those with serious issues (represented with a <code class="docutils literal notranslate"><span class="pre">-noQC</span></code> label):</p>
<ul class="simple">
<li><p><a class="reference external" href="https://storage.googleapis.com/cmip6/pangeo-cmip6-noQC.csv">https://storage.googleapis.com/cmip6/pangeo-cmip6-noQC.csv</a></p></li>
<li><p><a class="reference external" href="https://cmip6-pds.s3-us-west-2.amazonaws.com/pangeo-cmip6-noQC.csv">https://cmip6-pds.s3-us-west-2.amazonaws.com/pangeo-cmip6-noQC.csv</a></p></li>
</ul>
<p>For backward compatibility on GCS, we also maintain redundant copies called “cmip6-zarr-consolidated-stores.csv” and “cmip6-zarr-consolidated-stores-noQC.csv”.</p>
<p>The first 8 column names correspond to the standard CMIP keywords; the next three additional columns are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">zstore</span></code>: URL of the corresponding Zarr data store</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcpp_init_year</span></code>: optional metadata for convenience when accessing <a class="reference external" href="https://www.wcrp-climate.org/dcp-overview">DCPP</a>-type experiments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code>: approximate data of model output file as listed on ESGF in YYYYMMDD format</p></li>
</ul>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">-noQC</span></code> variants exclusively include three additional columns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">status</span></code>: status of the dataset’s issue, if any, using a controlled vocabulary:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">new</span></code>: issue has been recently raised with no other updates to status</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onhold</span></code>: issue is in the process of being examined or resolved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resolved</span></code>: issue has been resolved AND the corrected files have been published on ESGF with a new dataset version</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wontfix</span></code>: issue cannot/won’t be fixed by the data provider; may result in a persistent low severity issue with no consequences to analysis</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">severity</span></code>: severity of the dataset’s issue, if any, using a controlled vocabulary:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">low</span></code>: issue concerns file management (e.g., addition, removal, period extension, etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">medium</span></code>: issue concerns metadata (netCDF attributes) without undermining the values of the involved variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">high</span></code>: issue concerns single point variable or axis values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critical</span></code>: issue concerns the variable or axis values undermining the analysis; use of this data is strongly discouraged</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">issue_url</span></code>: link to view the issue on ESGF Errata Service</p></li>
</ul>
<p>There are currently over 400,000 entries - which is too large for Google Spreadsheets, but can be viewed in most standard spreadsheet applications and the entries can be sorted, selected and discovered quickly and efficiently.  We find that importing them as a python <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe is very useful.</p>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="background.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Background and Links</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="accessing_data.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Accessing data in the cloud</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Pangeo Community<br/>
        
            &copy; Copyright 2019-2021, Pangeo Community.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>