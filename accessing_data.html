
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta property="og:title" content="Accessing data in the cloud" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="accessing_data.html" />
  
<meta property="og:description" content="Once the master CSV file is understood, accessing data is a matter of searching for relevant datasets using the controlled vocabulary and opening them by pointing your Zarr package of choice to the..." />
  
    <title>Accessing data in the cloud &#8212; Pangeo / ESGF Cloud Data Working Group  documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pangeo Catalog" href="pangeo_catalog.html" />
    <link rel="prev" title="Zarr Data Overview" href="overview.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/small_e_logo_cropped.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Pangeo / ESGF Cloud Data Working Group  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="working_group.html">
   Working Group Meetings and Membership
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="background.html">
   Background and Links
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Zarr Data Overview
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Accessing data in the cloud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pangeo_catalog.html">
   Pangeo Catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="licensing_citation.html">
   Data Licensing and Citations
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/accessing_data.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/pangeo-data/pangeo-cmip6-cloud"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/pangeo-data/pangeo-cmip6-cloud/issues/new?title=Issue%20on%20page%20%2Faccessing_data.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/pangeo-data/pangeo-cmip6-cloud/edit/master/docs/accessing_data.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#opening-a-single-zarr-data-store">
   Opening a single Zarr data store
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manually-searching-the-catalog">
   Manually searching the catalog
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-an-esm-collection">
   Loading an ESM collection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#searching-for-datasets">
   Searching for datasets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-datasets">
   Loading datasets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preprocessing-the-cmip6-datasets">
   Preprocessing the CMIP6 datasets
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="accessing-data-in-the-cloud">
<h1>Accessing data in the cloud<a class="headerlink" href="#accessing-data-in-the-cloud" title="Permalink to this headline">Â¶</a></h1>
<p>Once the master CSV file is understood, accessing data is a matter of searching for relevant datasets using the controlled vocabulary and opening them by pointing your Zarr package of choice to their corresponding <code class="docutils literal notranslate"><span class="pre">zstore</span></code> URLs.
While this can be done using any language whose Zarr package supports the reading of remote data stores, the following examples will be in Python, showcasing the use of <a class="reference external" href="https://xarray.pydata.org/en/stable/">xarray</a>, <a class="reference external" href="https://intake.readthedocs.io/en/stable/">intake</a>, and <a class="reference external" href="https://intake-esm.readthedocs.io/en/stable/">intake-esm</a> to open and explore Earth System Model (ESM) collections of the CMIP6 data.</p>
<div class="section" id="opening-a-single-zarr-data-store">
<h2>Opening a single Zarr data store<a class="headerlink" href="#opening-a-single-zarr-data-store" title="Permalink to this headline">Â¶</a></h2>
<p>A standalone Zarr data store can be opened using xarrayâs <code class="docutils literal notranslate"><span class="pre">open_zarr()</span></code> function.
The function takes a Python-native <code class="docutils literal notranslate"><span class="pre">MutableMapping</span></code> as input, which can be acquired from a Zarr store URL using either <a class="reference external" href="https://gcsfs.readthedocs.io/en/latest/">gcsfs</a> or <a class="reference external" href="https://s3fs.readthedocs.io/en/latest/">s3fs</a>, depending on the cloud provider:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gcsfs</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># Connect to Google Cloud Storage</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;anon&#39;</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="s1">&#39;read_only&#39;</span><span class="p">)</span>

<span class="c1"># create a MutableMapping from a store URL</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="s2">&quot;gs://cmip6/CMIP6/CMIP/AS-RCEC/TaiESM1/1pctCO2/r1i1p1f1/Amon/hfls/gn/v20200225/&quot;</span><span class="p">)</span>

<span class="c1"># make sure to specify that metadata is consolidated</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>or, for the AWS datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">s3fs</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># Connect to AWS S3 storage</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">s3fs</span><span class="o">.</span><span class="n">S3FileSystem</span><span class="p">(</span><span class="n">anon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># create a MutableMapping from a store URL</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="s2">&quot;s3://cmip6-pds/CMIP6/CMIP/AS-RCEC/TaiESM1/1pctCO2/r1i1p1f1/Amon/hfls/gn/v20200225/&quot;</span><span class="p">)</span>

<span class="c1"># make sure to specify that metadata is consolidated</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the option <code class="docutils literal notranslate"><span class="pre">consolidated=True</span></code>, which relies on a consolidated metadata file to open and describe the Zarr data store with minimal data egress.</p>
</div>
<div class="section" id="manually-searching-the-catalog">
<h2>Manually searching the catalog<a class="headerlink" href="#manually-searching-the-catalog" title="Permalink to this headline">Â¶</a></h2>
<p>By downloading the master CSV file enumerating all available data stores, we can interact with the spreadsheet through a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">pandas DataFrame</a> to search and explore for relevant data using the <a class="reference external" href="https://github.com/WCRP-CMIP/CMIP6_CVs">CMIP6 controlled vocabulary</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># for Google Cloud:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://cmip6.storage.googleapis.com/pangeo-cmip6.csv&quot;</span><span class="p">)</span>
<span class="c1"># for AWS S3:</span>
<span class="c1"># df = pd.read_csv(&quot;https://cmip6-pds.s3.amazonaws.com/pangeo-cmip6.csv&quot;)</span>

<span class="n">df_subset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;activity_id==&#39;CMIP&#39; &amp; table_id==&#39;Amon&#39; &amp; variable_id==&#39;tas&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>From here, we can open any of the selected data stores using xarray, providing the value of the <code class="docutils literal notranslate"><span class="pre">zstore</span></code> column as input:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the path to a specific zarr store</span>
<span class="n">zstore</span> <span class="o">=</span> <span class="n">df_subset</span><span class="o">.</span><span class="n">zstore</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">get_mapper</span><span class="p">(</span><span class="n">zstore</span><span class="p">)</span>

<span class="c1"># open using xarray</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">consolidated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>When working with multiple data stores at the same time, it may be necessary to combine several together to form a dataset for analysis.
In these cases, it is easier to access them using an ESM collection with intake-esm.
An ESM collection contains metadata describing how data stores can be combined to yield highly aggregated datasets, which is used by intake-esm to automatically merge/concatenate them when they are loaded into an xarray container.
This eases the burden on the user to manually combine data, while still offering the ability to search and explore all of the available data stores.</p>
</div>
<div class="section" id="loading-an-esm-collection">
<h2>Loading an ESM collection<a class="headerlink" href="#loading-an-esm-collection" title="Permalink to this headline">Â¶</a></h2>
<p>To load an ESM collection with intake-esm, the user must provide a valid ESM collection specification as input to intakeâs <code class="docutils literal notranslate"><span class="pre">open_esm_datastore()</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">intake</span>

<span class="c1"># for Google Cloud:</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span><span class="s2">&quot;https://storage.googleapis.com/cmip6/pangeo-cmip6.json&quot;</span><span class="p">)</span>
<span class="c1"># for AWS S3:</span>
<span class="c1">#col = intake.open_esm_datastore(&quot;https://cmip6-pds.s3.amazonaws.com/pangeo-cmip6.json&quot;)</span>

<span class="n">col</span>
</pre></div>
</div>
<p>This gives a summary of the ESM collection, including the total number of Zarr data stores (referred to as assets), along with the total number of datasets these Zarr data stores correspond to.
The collection can also be viewed as a DataFrame:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">col</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="searching-for-datasets">
<h2>Searching for datasets<a class="headerlink" href="#searching-for-datasets" title="Permalink to this headline">Â¶</a></h2>
<p>After exploring the controlled vocabulary, itâs straightforward to get the data assets you want using intake-esmâs <code class="docutils literal notranslate"><span class="pre">search()</span></code> function.
In the example below, we will search for the following:</p>
<ul class="simple">
<li><p>variables: <code class="docutils literal notranslate"><span class="pre">tas</span></code> which stands for near-surface air temperature</p></li>
<li><p>experiments: <code class="docutils literal notranslate"><span class="pre">[&quot;historical&quot;,</span> <span class="pre">&quot;ssp245&quot;,</span> <span class="pre">&quot;ssp585&quot;]</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">historical</span></code>: all forcing of the recent past</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssp245</span></code>: update of <a class="reference external" href="https://en.wikipedia.org/wiki/Representative_Concentration_Pathway">RCP4.5</a> based on SSP2</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ssp585</span></code>: emission-driven <a class="reference external" href="https://en.wikipedia.org/wiki/Representative_Concentration_Pathway">RCP8.5</a> based on SSP5</p></li>
</ul>
</li>
<li><p>table ID: <code class="docutils literal notranslate"><span class="pre">Amon</span></code> which stands for monthly atmospheric data</p></li>
<li><p>grid label: <code class="docutils literal notranslate"><span class="pre">gr</span></code> which stands for regridded data reported on the data providerâs preferred target grid</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># form query dictionary</span>
<span class="n">query</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">experiment_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;historical&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp245&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp585&#39;</span><span class="p">],</span>
             <span class="n">table_id</span><span class="o">=</span><span class="s1">&#39;Amon&#39;</span><span class="p">,</span>
             <span class="n">variable_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tas&#39;</span><span class="p">],</span>
             <span class="n">member_id</span> <span class="o">=</span> <span class="s1">&#39;r1i1p1f1&#39;</span><span class="p">,</span>
             <span class="n">grid_label</span><span class="o">=</span><span class="s1">&#39;gr&#39;</span><span class="p">)</span>
<span class="c1"># subset catalog and get some metrics grouped by &#39;source_id&#39;</span>
<span class="n">col_subset</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">require_all_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;source_id&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>
<span class="n">col_subset</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;source_id&#39;</span><span class="p">)[[</span><span class="s1">&#39;experiment_id&#39;</span><span class="p">,</span> <span class="s1">&#39;variable_id&#39;</span><span class="p">,</span> <span class="s1">&#39;table_id&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-datasets">
<h2>Loading datasets<a class="headerlink" href="#loading-datasets" title="Permalink to this headline">Â¶</a></h2>
<p>Once youâve identified data assets of interest, you can load them into xarray dataset containers using intake-esmâs <code class="docutils literal notranslate"><span class="pre">to_dataset_dict()</span></code> function.
Invoking this function yields a Python dictionary of high-level aggregated xarray datasets.
The logic for merging/concatenating the query results into datasets is provided in the input JSON file, under <code class="docutils literal notranslate"><span class="pre">aggregation_control</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>&quot;aggregation_control&quot;: {
  &quot;variable_column_name&quot;: &quot;variable_id&quot;,
  &quot;groupby_attrs&quot;: [
    &quot;activity_id&quot;,
    &quot;institution_id&quot;,
    &quot;source_id&quot;,
    &quot;experiment_id&quot;,
    &quot;table_id&quot;,
    &quot;grid_label&quot;
  ],
  &quot;aggregations&quot;: [{
      &quot;type&quot;: &quot;union&quot;,
      &quot;attribute_name&quot;: &quot;variable_id&quot;
    },

    {
      &quot;type&quot;: &quot;join_new&quot;,
      &quot;attribute_name&quot;: &quot;member_id&quot;,
      &quot;options&quot;: {
        &quot;coords&quot;: &quot;minimal&quot;,
        &quot;compat&quot;: &quot;override&quot;
      }
    },
    {
      &quot;type&quot;: &quot;join_new&quot;,
      &quot;attribute_name&quot;: &quot;dcpp_init_year&quot;,
      &quot;options&quot;: {
        &quot;coords&quot;: &quot;minimal&quot;,
        &quot;compat&quot;: &quot;override&quot;
      }
    }
  ]
}
</pre></div>
</div>
<p>Though these aggregation specifications are sufficient to merge individual data assets into xarray datasets, sometimes additional arguments must be provided depending on the format of the data assets.
For example, Zarr-based assets can be loaded with the option <code class="docutils literal notranslate"><span class="pre">consolidated=True</span></code>, which relies on a consolidated metadata file to describe the assets with minimal data egress:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dsets</span> <span class="o">=</span> <span class="n">col_subset</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                                   <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="s1">&#39;anon&#39;</span><span class="p">})</span>
<span class="c1"># list all merged datasets</span>
<span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dsets</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
</pre></div>
</div>
<p>When the datasets have finished loading, we can extract any of them like we would a value in a Python dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">dsets</span><span class="p">[</span><span class="s1">&#39;ScenarioMIP.THU.CIESM.ssp585.Amon.gr&#39;</span><span class="p">]</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="section" id="preprocessing-the-cmip6-datasets">
<h2>Preprocessing the CMIP6 datasets<a class="headerlink" href="#preprocessing-the-cmip6-datasets" title="Permalink to this headline">Â¶</a></h2>
<p>Once you are comfortable with the basic <cite>intake-esm</cite> features, you may notice that many datasets cannot be easily combined and manipulated without some time consuming debugging. Julius Buseckeâs very useful package, <a class="reference external" href="https://github.com/jbusecke/cmip6_preprocessing/">cmip6_preprocessing</a>, can be added which does some of this cleanup for you - especially for the very tricky âOmonâ datasets. See, for example, this <a class="reference external" href="https://github.com/jbusecke/cmip6_preprocessing/blob/HEAD/docs/tutorial.ipynb">tutorial</a> .</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cmip6_preprocessing.preprocessing</span> <span class="kn">import</span> <span class="n">combined_preprocessing</span>
</pre></div>
</div>
<p>and then you can use this when calling <code class="docutils literal notranslate"><span class="pre">to_dataset_dict</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dsets</span> <span class="o">=</span> <span class="n">col_subset</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span>
  <span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;decode_times&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
  <span class="n">aggregate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
  <span class="n">preprocess</span><span class="o">=</span><span class="n">combined_preprocessing</span><span class="p">,</span>
  <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="s1">&#39;anon&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="c1"># AWS needs a slightly different syntax for the storage options</span>
<span class="n">dsets</span> <span class="o">=</span> <span class="n">col_subset</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span>
  <span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;decode_times&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
  <span class="n">aggregate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
  <span class="n">preprocess</span><span class="o">=</span><span class="n">combined_preprocessing</span><span class="p">,</span>
  <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="overview.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Zarr Data Overview</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pangeo_catalog.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Pangeo Catalog</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Pangeo Community<br/>
        
            &copy; Copyright 2019-2022, Pangeo Community.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>